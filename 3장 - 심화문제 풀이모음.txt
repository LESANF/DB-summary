< 마당서적 테이블을 기준으로 한다. >

(1) 박지성이 구매한 도서의 출판사와 같은 출판사에서 도서를 구매한 고객의 이름

SELECT DISTINCT name
FROM Customer, Orders, Book
WHERE Customer.custid=Orders.custid 
            AND Orders.bookid=Book.bookid 
            AND publisher IN(SELECT publisher
                                   FROM Customer, Orders, Book
                                   WHERE Customer.custid=Orders.custid AND Orders.bookid=Book.bookid AND Customer.name Like '박지성');


풀이) 

WHERE절에서 Customer.custid=Orders.custid AND Orders.bookid=Book.bookid 해당 구문은 세 개의 테이블을 이어주는 역할이다.
Customer와 Book테이블은 서로 공통되는 속성(Column)이 없으므로, Orders의 속성을 참조해야한다.

그리고 publisher IN() 이란 publisher의 투플중 ()안에 해당되는 요소와 매칭된 투플만 뽑아내는 행위이다.

문제의 중점은 박지성이 구매한 도서의 출판사, 그리고 그 출판사의 책을 구입한 사람의 이름이다.
부속질의를 이용하여 publisher를 SELECT의 요소로 선택하고, 그 중 박지성이라는 이름이 들어간 투플을 LIKE를 통해 뽑아낸다.
박지성이라는 이름이 들어가는 publisher의 목록을 얻을 수 있고 이는 IN의 요소로 들어가 문제를 해결할 수 있다.
----------------------------------------------------------------------------------------------------------------------------------------------------

(2) 두 개 이상의 서로 다른 출판사에서 도서를 구매한 고객의 이름

SELECT name
FROM (SELECT name, publisher
          FROM Customer, Orders, Book
          WHERE Customer.custid=Orders.custid AND Orders.bookid=Book.bookid
          GROUP BY name, publisher)
GROUP BY name
HAVING COUNT(publisher) > 1;


풀이)

GROUP BY와 DISTINCT는 동일한 기능을 가졌지만(중복방지), 다른 연산이다.
DISTINCT는 단순히 UNIQUE값만을 추출하기 위해 사용하는 것이고, GROUP BY는 집계키 기준으로 집합연살을 위해 사용하는 것이다.
집합 연산을 간략하게 짚고 넘어가면 우리가 흔히 잘 알고 잘 사용하고 있는 COUNT(*), SUM(), AVG(), MAX(), MIN()등이 있다.

위와같이 설명을 하고 들어가는 이유는 이문제의 핵심은 GROUP BY에 복수로 적용되는 속성(column)이 있기때문이다.
문제를 쉽게 해석해보면 << 두 개 이상의 도서를 구매한 고객의 이름을 구하는데 조건은 서로 다른출판사가 기준이다 >>

먼저 GROUP BY name, publisher로 중복을 최소화하며 뽑을 수 있는 그룹을 모두 뽑는다.
그 뽑힌 name, publisher로 부터 다시한번 문제에서 필요로하는 고객의 이름을 뽑아내기위해 name으로 그룹화 한다.
이제 name기준으로 다시 그룹화 됐으며, 서로 다른 출판사도 하나의 name안으로 그룹화 된다.

GROUP BY는 항상 집계함수와 써야하고, 여기서 쓰이는 집계함수는 열을 셀 수 있는 COUNT함수다.
COUNT함수로 개수를 세고, 조건인 두 개 이상( x > 1)의 조건을 달면 문제에서 원하는 답을 이끌어 낼 수 있다.
----------------------------------------------------------------------------------------------------------------------------------------------------

(3) 전체 고객의 30% 이상이 구매한 도서

